---
# fontsize: 11pt
# mainfont: arial
format:
 # html: default
 docx:
    number-sections: false
    global-numbering: true
    reference-doc: "../../../../HeadRs/rmd_templates/style-guide-arial-11.docx"
bibliography: "`r path.expand('~/Box Sync/papers/EnvEpi.bib')`"
csl: "`r path.expand('~/HeadRs/csl/ama.csl')`"
notes-after-punctuation: true
execute:
  freeze: auto
editor_options: 
  chunk_output_type: inline
editor: 
  markdown: 
    wrap: 72
---

```{r, include=FALSE}
library(here)
knitr::opts_chunk$set(echo=F, results = 'asis')
library(bibtex)
biblio <- bibtex::read.bib('~/Box Sync/papers/EnvEpi.bib')
library(flextable)
library(data.table)
library(ggplot2); library(magrittr)
```

# Abstract

(Limit: 200 words)

Non-Hodgkin lymphoma (NHL) incidence was recently linked to exposure to
metalworking fluid (MWF) in a standard survival analysis of the United
Auto Workers-General Motors cohort. To provide results more directly
relevant to guiding exposure limits, we estimated the counterfactual
risks of NHL under hypothetical supportable interventions on exposure to
MWF in the same cohort (n = 33,134) for 1985-2015 using the
hazard-extended iterative conditional expectation g-formula. We
addressed potential bias due to the healthy worker survivor effect while
investigating stochastic dynamic interventions that avoid extrapolation
beyond observed conditional exposure distributions, thus guaranteeing
positivity by design. These interventions reduced exposures above
specified target limits to the nearest supported level of exposure but
allowed exposures below the limit to vary naturally. 339 NHL cases
occurred over the 30-year follow-up period. Stronger target limits on
MWF exposure resulted in monotonic reductions in NHL risk. Setting the
target exposure limit at 0.5 mg/m^3^, the NIOSH recommended exposure
limit, would have prevented 124 (95% CI: 66, 202) cases. We expect that
uniformly enforcing the target exposure limits, regardless of data
support, would have yielded even stronger protective effects.
Strengthening protections against exposure to MWF may protect workers
from NHL during the anticipated boom in domestic manufacturing.

\newpage

# Introduction

Non-Hodgkin Lymphoma (NHL) incidence in the United States doubled
between 1973 and 1994 before plateauing at around 19 per 100,000
persons per year, making it the seventh most common cancer in the
country [@seer_1994; @Ekstrom-Smedby_2006]. The strongest known risk
factors of NHL are autoimmune disease and immunosuppression
[@Filipovich_1992; @Chiu_2015]. The relationship between autoimmune
diseases NHL is specific in that each disease is associated with a
particular subtype of NHL [@Thandra_2021]. Immunosuppression and
infection with HIV are strongly associated with Burkitt lymphoma
[@Thandra_2021]. These risk factors cannot fully explain the historic
rise or present burden of NHL, however [@Shiels_2013]. Since the
rise in NHL incidence coincided with a period of rapid and extensive
chemicalization in industry, agriculture and warfare; environmental
and occupational exposures may play an important explanatory role in
the epidemiology of NHL [@Nelson_2005; @Romero_2021]. Existing
epidemiologic studies suggest that occupational exposures may increase
the risk of NHL without subtype specificity [@Thandra_2021].

Pesticide exposure among workers in agricultural settings was a common
target of NHL research in recent decades. A meta-analysis of 44 articles
published between 1980 and 2014 found statistically significant
associations between NHL and exposure to several classes of pesticides
including carbamate, organophosporus, triazine, and organochlorine
[@Schinasi_2014]. Occupational exposures associated with NHL are not
limited to the agricultural sector, however. Occupational groups
associated with NHL risk also include metal processors, health workers,
salespeople, machinists, and electricians [@Fritschi_2005a;
@Mester_2006; @Ekstrom-Smedby_2006]. Workers in these occupational
groups often come into contact with industrial chemicals such as
gasoline, solvents, coolants, and lubricants such as metalworking fluids
(MWF).

Metalworking fluids are complex mixtures of oil, water, and chemical
additives that cool and lubricate metal machining operations. There are
three general types of MWF: straight, soluble, and synthetic. During
shaping, grinding, and cutting operations, MWFs are misted, poured, or
blasted at high pressure onto work surfaces to remove debris, cool
metal, improve efficiency, and prevent deterioration of tools. Although
MWFs are essential to manufacturing processes, they also present a
potential health hazard to exposed workers through inhalation or
ingestion of MWF particulate mass. In response to health concerns
related to the carcinogenicity of polycyclic aromatic hydrocarbons
(PAHs) in mineral oil as well as the rising global cost of oil products,
water-based soluble MWF, which usually contain about 40-70% oil by
weight, were developed to replace oil-based straight MWF [@IARC_1973;
@IARC_1987; @Childers_2006]. Today, soluble MWF is the most common type
of MWF in metal machining operations [@Byers_2006].

One challenge in estimating the causal effects of occupational exposures
on worker health is the Healthy Worker Survivor Effect (HWSE), the
process by which healthier individuals remain at work where they
accumulate more exposure while those more susceptible to the deleterious
health effects of exposure leave work [@Arrighi_1994]. The parametric
g-formula is an early causal inference method in statistics developed to
estimate causal effects in longitudinal observational studies where the
HWSE or other forms of time-varying confounding/selection bias affected
by past exposure may be operating [@Robins_1986; @Taubman_2009;
@Richardson_2013]. A central requirement necessary for causal inference
from observational data is positivity (overlap), *i.e.,* adequate
variation in the exposure of interest within strata formed by confounder
and exposure histories [@Petersen_2012].

When positivity is not satisfied, causal inference methods that rely
only on models for the counterfactual outcome, and not the treatment
mechanism, may still yield valid causal estimates, if the models are
correctly specified. We evaluated how hypothetical interventions on
exposure to soluble MWF would affect the incidence of NHL between 1985
and 2015 in the United Auto Workers-General Motors (UAW-GM)
occupational cohort using the iterative conditional expectation (ICE)
parametric g-formula, which relies on models for the outcome only. To
further address potential violations in positivity, we defined and
evaluated hypothetical interventions resulting in post-intervention
exposure histories whose propensity score is strictly greater than 
zero _i.e._, exposure histories that can be found in the observed
data. We call these hypothetical interventions "supportable".

<!-- The parametric g-formula has become increasingly popular among epidemiologists in the last decade, and there are several exemplary tutorial papers and illustrative examples [@Taubman_2009;@Breskin_2020]. This analytic approach is attractive in part because it allows investigators to estimate the population-level effect of realistic interventions on exposures that may depend on individuals' covariate history as well as their natural value of exposure. In addition to yielding estimates with a population-level interpretation, the parametric g-formula is also capable of adjusting for time-varying confounding possibly affected by past exposure in longitudinal settings, which is not possible with standard regression methods. In their seminal 2009 paper, Taubman et alia describe the parametric g-formula and illustrate its application in the estimation of the counterfactual risks under several interventions in the Nurses' Health Study [@Taubman_2009]. They introduced a non-iterative conditional expectation parametric g-formula that requires parametric specification of the full joint distribution of confounders, exposures, and outcomes over time. -->

<!-- Full parameterization is an attractive choice for investigators seeking to embed real causal knowledge into the estimation problem. For those who are not completely comfortable with the full set of parametric assumptions, the iterative conditional expectation (ICE) parametric g-formula may be a good alternative. The ICE g-formula was introduced as early as 2004 [@Robins_2004], but its parametric implementations remain far less common in practice than its non-ICE counterpart. Like the non-ICE parametric g-formula, the ICE expression enables adjustment for time-varying confounding possibly affected by past exposure. However, the ICE parametric g-formula requires the parametric specification of models for the outcome only, and not the confounders or exposure. Hence, it requires fewer parametric assumptions than the non-ICE parametric g-formula. Furthermore, the elegance of the ICE parametric g-formula allows analysts to implement the method using standard statistical software, which offers the prospect of greater interpretability and transparency than using "black box" implementations. -->

<!-- In recent years, there has been a surge in optimism for growth in American manufacturing [@Carr_2022;@Armbrust_2021]. While it may be easy to imagine a factory floor crowded with workers and heavy machinery, an essential part of the industrial production of physical goods is easy to overlook: lubricants and coolants. In industries that require metalworking, from cutting wafers for semiconductor production to stamping metals for electric vehicle battery casings, metalworking fluids (MWF) are essential. During use in drawing, stamping, cutting, and grinding operations, MWF are sprayed and poured onto tools and parts to provide lubrication and cooling. Parts may even be submerged in MWF in precision manufacturing applications [@Arrabiyeh_2020]. -->

# Methods

We estimated the cumulative incidence of NHL between 1985 and 2015 under
supportable interventions based on selected target exposure limits on
annual average daily exposure to soluble MWF by applying the
hazard-extended ICE parametric  we estimated the expected number of NHL
cases that we would observe if there were no censoring and no limit on
exposure. Then, we contrasted this case count to that under supportable
interventions based on five hypothetical target exposure limits and no
censoring. The five target exposure limits were (1) 2.0, (2) 1.0, (3)
0.5, (4) 0.25, and (5) 0.05 mg/m^3^. The National Institute for
Occupational Safety and Health (NIOSH) recommended exposure limit (REL)
for time-weighted average total particulate mass (PM) composed of MWF is
0.5 mg/m^3^ [@niosh_1998].

For each target exposure limit, period of follow-up, and stratum defined
by unique combinations of confounder and exposure histories, we found a
supportable exposure limit, which was the maximum observed value of
exposure at or below the target exposure limit, if such a value exists.
If all of the observed values were above the target limit, the
supportable limit was the minimum observed value. The supportable
intervention rule then reduces exposures above the supportable exposure
limit to that limit, but allows exposures at or below the limit to vary
according to their observed distribution. Applying the supportable
intervention rule to the observed distribution of exposure produces the
intervention distribution that defines the corresponding stochastic
dynamic intervention with guaranteed positivity. We estimated the effect
of supportable intervention rules based on the selected target exposure
limits, expressed as stochastic dynamic interventions, using the
hazard-extended ICE parametric g-formula [@Wen_2020].

Figure 1 presents three example scenarios where the target exposure
limit is 0.25 mg/m^3^ in all cases, but the supportable exposure limit
differs depending on what the observed data supports. In Figure 1a, the
supportable exposure limit is equal to the target exposure limit as some
individuals with that particular set of potential confounder and
exposure histories were observed to have experienced exposure at that
level. In Figure 1b, the supportable exposure limit is below the target
exposure limit. In Figure 1c, the supportable exposure limit, the
minimum observed level of exposure in that stratum, is greater than the
target exposure limit.

::: {#fig-rules layout-ncol="2"}
![](resources/images/intervention-density-witnin-combos-a.png){#fig-1a
width="3.5in"}
![](resources/images/intervention-density-witnin-combos-b.png){#fig-1b
width="3.5in"}
![](resources/images/intervention-density-witnin-combos-c.png){#fig-1c
width="3.5in"}

Observed and post intervention distribution of nonzero exposure for
three distinct confounder and exposure histories before and after
applying the supportable intervention rule.
:::

## Study population

We used data from the UAW-GM cohort study, which included all hourly
workers at three automobile manufacturing plants in Michigan who had
worked at least three years by 1985. Past papers provide detailed
descriptions of the cohort [@Eisen_1992; @Eisen_2001]. The large size of
the study population and rich time-varying, quantitative MWF exposure
data enable the study of a relatively rare cancer and evaluation of
realistic interventions on MWF exposure in a longitudinal cohort
setting. The present study population (N = 33,134) was restricted to the
autoworkers who were at work in 1941 or not yet hired, missing no more
than half of their employment history, and still alive at the start of
follow-up for cancer incidence on January 1, 1985. Autoworkers in the
study population were followed until NHL diagnosis, death, December 31,
2014, or the oldest observed age at death, whichever came earlier.

## Outcome and potential confounders

We identified incident cancers in the UAW-GM cohort between 1985 and
2014 by linkage to the Michigan Cancer Registry (MCR). Workers at Plants
1 and 2, located in the greater Detroit metropolitan area, were also
linked to the Detroit Regional Registry of the Surveillance,
Epidemiology, and End Results (SEER) Program. Cancer types were
distinguished using site and histology codes conforming to the
International classification of Diseases for Oncology, 3^rd^ edition
(ICD-O-3). Non-Hodgkin lymphoma was defined by cancers with any of the
following ICD-O-3 histology codes: 9590-9597, 9670-9671, 9673, 9675,
9678-9680, 9684, 9687-9691, 9695, 9698-9702, 9705, 9708-9709, 9712,
9714-9719, 9724-9729, 9735, 9737-9738, 9811-9818, 9823, 9827, 9837.
Details regarding cancer incidence follow-up are described elsewhere
[@Colbeth_2022]. Vital status was ascertained from company records and
by linkage to Social Security Administration, National Death Index, and
state mortality files.

Potential confounders including year of hire, sex, race, time off work,
employment status, and plant location were obtained from company
records. Race was missing for about 16% of the cohort, most commonly
among workers hired before 1960 in Plant 2. In analyses, missing race
was considered a distinct category. All potential confounders were coded
as categorical variables. Cut-points for categorizing continuous
covariates were determined according to the quantiles among cases.

## Exposure

Quantitative measurement of time-varying MWF exposure is a
distinguishing strength of the UAW-GM cohort study relative to other
environmental or occupational health studies. Exposure assessment was
based on direct air sampling as well as company records. Company
industrial hygienists collected several hundred personal and area
samples for total particulate mass (mg/m^3^) composed of MWF over many
decades. Research industrial hygienists collected additional air
sampling data when the cohort study was launched in the mid 1980s
[@Woskie_1994; @Woskie_1994a]. These additional data combined with
historical data and company records were used to construct a
job-exposure matrix of quantitative 8-hour time-weighted average daily
exposure estimates to soluble, straight, and synthetic MWF for each
combination of job, department, and plant over time [@Hallock_1994].
Workers' annual average daily exposure to each MWF type was determined
by combining this job-exposure matrix with employment records, which
recorded time-varying job type, department, and plant for each employee
from hire to termination or 1995, whichever came sooner. For employment
records that were at least half complete, gaps in the record were
interpolated by carrying forward the last known job type. The exposure
assessment is described in detail elsewhere [@Hallock_1994;
@Woskie_1994; @Woskie_2003].

In previous analyses of NHL, exposure lags of 1 to 20 years were applied
to account for disease latency; we lagged cumulative MWF exposures by 20
years [@Smith_2007; @Karipidis_2007; @Zhang_2019]. In analyses, MWF
exposure history at start of follow-up was summarized as the cumulative
sum of average exposure intensities. Exposure was coded as categorical
variables with cut-points at zero and the quintiles of nonzero exposure
among cases. We estimated the effects of hypothetical interventions on
soluble MWF, the type of MWF used most widely and in the greatest
quantities while treating co-exposure to straight and synthetic MWFs as
potential confounders.

## Hazard-extended ICE parametric g-formula

We split the 30-year follow-up period into ten time periods based on the
deciles of the dates of diagnosis of NHL. The number of years per period
ranged from two to four. The hazard-extended ICE parametric g-formula
involves two stages. In the first, we estimate counterfactual discrete
hazards over the person-periods. In the second, we pool those estimates
to estimate the counterfactual risk over the entire follow-up period.
During pooling, we iteratively combine estimates of the counterfactual
hazard to obtain a pooled estimate over an increasing number of periods
starting from the last period. In each iteration, we perform model-based
standardization over exposure and covariate histories before combining
the counterfactual discrete hazard estimate with the estimated hazard
pooled over subsequent periods. This iterative process results in a
sequentially standardized estimate of the counterfactual cumulative
incidence of NHL when the intervention of interest is enforced over all
follow-up periods.

We investigated supportable interventions that guarantee positivity:
every value of exposure that could be assigned under our stochastic
dynamic intervention has propensity score strictly greater than zero. We
treated co-exposure to straight and synthetic MWF, employment status,
cumulative time off, age, duration of employment, sex (male/female),
race (Black/white/unknown), and plant (Plant 1/Plant 2/Plant 3) as
potential confounders. Exposure to MWF, employment status, time off, and
duration of employment were lagged 20 years. An overview of the general
steps of the estimation procedure are presented below. Note that we
refer to discrete hazards simply as hazards.

1.  Fit a pooled logistic regression model for NHL on potential
    confounders and exposure over all at-risk person-periods.

2.  Predict the hazard for each person-period for each possible level of
    exposure using the model from step 1.

3.  Within strata formed by unique combinations of potential confounders
    and exposure, obtain the intervention distribution of exposure by
    applying the supportable intervention rule to the observed exposure
    distribution.

4.  Within strata, estimate the counterfactual hazard for each
    person-period by taking a weighted sum of the predicted hazards from
    step 2.

5.  Starting at the penultimate period of follow-up, estimate the pooled
    counterfactual hazard:

    a)  Regress the counterfactual hazard pooled over all subsequent
        periods on all past potential confounders and exposures.
    b)  Predict the pooled hazard for each person at risk at the start
        of the period and each possible level of exposure using the
        model from (a). Retrieve the predicted hazards from step 2. For
        each person and level of exposure, multiply the predicted pooled
        hazard by one minus the corresponding predicted hazard. Then,
        add the predicted hazard to the product.
    c)  Within strata formed by potential confounder and exposure
        histories, obtain the intervention distribution of exposure by
        applying the intervention rule to the observed exposure
        distribution.
    d)  Within strata, estimate the counterfactual hazard pooled over
        the present and subsequent periods for each person by taking a
        weighted sum of the predicted pooled hazards from (b).
    e)  If the present period is not first period, set the reference
        period to the preceding period and return to (a).

6.  Compute the counterfactual risk by averaging the pooled
    counterfactual hazards across all persons.

To account for censoring, fit the models in step 1 and step 5a among
those who were not censored and obtain predicted hazards for all at-risk
person-periods, including those that were censored.

We estimated cumulative incidence under no intervention on soluble MWF
and under the supportable interventions based on the five selected
target exposure limits. We contrasted the cumulative incidence under the
supportable interventions to that under no intervention on exposure by
computing the number of cases averted and the cumulative incidence
ratios. Confidence intervals were computed using the basic nonparametric
bootstrap with 1000 Monte Carlo samples from the population at the start
of follow-up. All the necessary scripts used to reproduce the analyses
are available on [GitHub](https://github.com/kvntchn/gm-nhl-ice).

```{r}
source(here::here("../gm-wrangling/wrangling/table1.R"))
clean.tab1 <- function(tab1) {
  # hspace.which <- grepl("\\\\hspace\\{.*\\}", rownames(tab1))
	rownames(tab1) <- gsub(
		"\\\\hspace\\{.*\\}|\\\\hline |\\$.*\\$| among deceased",
		"",
		rownames(tab1))
	
  tab1[!grepl("median", tab1[,4]) & !is.na(tab1[,1]), 2]  <-  paste0(
    "(",
    tab1[!grepl("median", tab1[,4]) & !is.na(tab1[,1]), 2],
    ")"
  )
  
  
  tab1[grepl("median", tab1[,4]) & !is.na(tab1[,1]), 2] <- paste0(
    "(", tab1[grepl("median", tab1[,4]) & !is.na(tab1[,1]), 2], ", ",
    tab1[grepl("median", tab1[,4]) & !is.na(tab1[,1]), 3],
    ")"
  )
  
  return(tab1[,1:2])
}
full.tab1 <- readRDS(here::here("resources", "tab1.rds"))
nhl.tab1 <- readRDS(here::here("resources", "nhl.tab1.rds"))

tab1.clean <- clean.tab1(full.tab1)
nhl.tab1.clean <- clean.tab1(nhl.tab1)

tab1 <- cbind(hspace.logical = grepl("\\\\hspace\\{.*\\}", rownames(full.tab1)),
              variable = rownames(tab1.clean), tab1.clean, NA, nhl.tab1.clean)

tab1 <- tab1[!grepl("Years of follow-up", rownames(tab1)),]
tab1$variable[1] <- "N (person-years)"
```

# Results

Table 1 presents summary statistics for the full study population and
among those diagnosed with NHL between 1985 and 2015. The cohort is
predominantly white (64%) and male (86%). Year of hire and age at hire
were approximately the same among those with NHL and the full study
population. Median lagged cumulative exposure to all three types of MWF
was higher among NHL cases. Soluble MWF were the most widely used type,
with approximately 88% of workers ever exposed. Median cumulative
exposure among the exposed was approximately 6 times higher for soluble
than for straight MWF. Figure 2 shows median annual average daily
exposure to the three MWF types among exposed workers over calendar
time. Exposure to MWF generally followed a downward trend over time.

```{r}
# tab1 <- tab1[tab1.which,]
tab1.sub <- tab1[c(1:13, 15, 14, 16:27, 29, 28, 30),]
tab1.sub <- tab1.sub[-c(17, 21, 26),]
tab1.sub_hspace <- tab1.sub$hspace.logical
tab1.sub <- tab1.sub[,-grep('hspace.logical', names(tab1.sub))]
```

```{r}
tab1.sub |> 
  data.frame() |> flextable() |>
  delete_part(part = "header") |>
  add_header_row(values = c("", "Study population", "", "NHL cases"),
                 colwidths = c(1, 2, 1, 2)) |>
  hline_top(part = "header") |>
  hline_top() |> hline_bottom() |>
  hline(which((grepl("[0-9]\\)", tab1.sub$spread))[-1])[1]) |> width(4, 0.1) |>
  width(1, 2.2) |> width(c(3, 6), 1.1) |> width(c(2, 5), 0.65) |>
  flextable::compose(
    i = grep("Cumulative exposure", rownames(tab1.sub)), j = 1,
    value = as_paragraph("Cumulative exposure to MWF (mg/m",
                         as_sup("3"), "-years)")) |>
  flextable::align(j = 2:6, align = "center", part = "all") |>
  footnote(i = grep("Plant$", rownames(tab1.sub)), j = 1, value = as_paragraph(
    " Plant of longest employment duration among those who worked at multiple plants"),
    ref_symbols = "a", inline = T) |>
  footnote(i = grep("Ever exposed|time off", rownames(tab1.sub)), j = 1, value = as_paragraph(
    " Lagged 20 years"),
    ref_symbols = "b", inline = T) |>
  # footnote(i = grep("work", rownames(tab1.sub)), j = 1, value = as_paragraph(
  #   " Among those who left work by December 31, 1994"),
  #   ref_symbols = "c", inline = T) |>
  # footnote(i = grep("death", rownames(tab1.sub)), j = 1, value = as_paragraph(
  #   " Among deceased"),
  #   ref_symbols = "d", inline = T) |>
  footnote(i = grep("Cumulative exposure", rownames(tab1.sub)), j = 1, value = as_paragraph(
    " Among ever-exposed individuals, lagged 20 years."),
    ref_symbols = "d", inline = T) |>
  add_footer_row(values = "NHL: non-Hodgkin lymphoma.", colwidths = 6) |>
  padding(padding = 1.5, part = "all") |>
  padding(
    i = which(tab1.sub_hspace),
    j = 1,
    padding.left = 20
  ) |>
  merge_at(i = grep("Cumulative exposure", rownames(tab1.sub))) |>
  hline_bottom(part = "footer") |> font(fontname = 'arial') |>
	set_caption(
		caption = paste0(
			"Summary of population characteristics. Statistics shown above ",
			"the horizontal line are count (%). Those shown below are median ",
			"(quartile 1, quartile 3).")
	)
```

\

![Figure 2. Median annual average daily exposure to soluble, straight,
and synthetic metalworking fluids among exposed workers over
time.](../../resources/images/exposure.png){width="6.5in"}

```{r}
load(here::here("resources", paste0("estimates.rdata")))
estimates.bs <- readRDS(here::here("resources", paste0("estimates.bs.rds")))
```

```{r}
# Risk ratios
do.call(cbind, lapply(estimates.bs[,-(1:2)], function(x) {
  x/estimates.bs[,2]
})) %>% melt(measure.vars = names(.)) -> rr.bs

# Risk differences
do.call(cbind, lapply(estimates.bs[,-(1:2)], function(x) {
  x - estimates.bs[,2]
})) %>% melt(measure.vars = names(.)) -> rd.bs

estimates.bs[,-1] %>% melt(measure.vars = names(.)) -> risk.bs

# Collect point estimates
point_estimates <- data.table(
  variable = c(
    "200", "100", "50", "25", "05", "Any"),
  estimate =  c(sapply(estimates[2:6], mean),
                mean(estimates[[1]]))
)
```

```{r}
# Calculate risk ratios for each bootstrap sample
rr <- merge(
  rr.bs,
  point_estimates[,.(
    variable = paste0(variable, ".Any"),
    estimate = estimate/estimate[variable == "Any"]
  )],
  all.x = F,
  by = "variable")

# Get lower and upper 2.5th %tiles
rr <- rr[,.(
  rr = estimate[1],
  rr_lower = 2 * estimate[1] - quantile(value, 1 - 0.025),
  rr_upper = 2 * estimate[1] - quantile(value, 0.025)
  ),
variable]
```

```{r}
# Calculate risk differences for each bootstrap sample
rd <- merge(
  rd.bs,
  point_estimates[,.(
    variable = paste0(variable, ".Any"),
    estimate = estimate - estimate[variable == "Any"]
  )],
  all.x = F,
  by = "variable")

# Get lower and upper 2.5th %tiles
N <- 33134
rd <- rd[,.(
  rd = - estimate[1],
  rd_lower = - (2 * estimate[1] - quantile(value, 0.025)) * N,
  rd_upper = - (2 * estimate[1] - quantile(value, 1 - 0.025)) * N
  # wald.lower = exp(log(estimate[1]) + qnorm(0.025) * sd(log(value))),
  # wald.upper = exp(log(estimate[1]) - qnorm(0.025) * sd(log(value)))
),
variable]
```

```{r}
# Combine differences and ratios
contrasts.tab <- merge(rr, rd, by = 'variable')
```

```{r}
# Collect risks
risks <- merge(
  risk.bs,
  point_estimates,
  all.x = F,
  by = "variable")

# Get lower and upper 2.5th %tiles
risks <- risks[,.(estimate = estimate[1],
      lower = 2 * mean(value) - quantile(value, 1 - 0.025),
      upper = 2 * mean(value) - quantile(value, 0.025)
      # wald.lower = exp(log(estimate[1]) + qnorm(0.025) * sd(log(value))),
      # wald.upper = exp(log(estimate[1]) - qnorm(0.025) * sd(log(value)))
      ),
   .(variable.risks = variable)]
```

```{r}
intervention.labels <- data.table(
  variable = c(
    "200", "100", "50", "25", "05", "Any"
  ),
  label = c(
    "2.0", "1.0", "0.5", "0.25", "0.05", "None"
  )
)

# Add intervention labels
contrasts.tab <- merge(
  contrasts.tab, intervention.labels[,.(variable = paste0(variable, ".Any"), label)],
  all = T,
  by = "variable"
)

```

```{r}
clean_percent_py <- function(variable, digits = 1, scale = 100) {
  sprintf(paste0("%.", digits, "f"), round(
    intervened_py[match(
       sapply(variable, gsub, pattern = ".Any", replacement = ""),
       variable.dat
  ), percent_py_intervened] * scale,
  digits))
}

clean_risk <- function(variable, digits = 2, scale = 1000) {
  sprintf(paste0("%.", digits, "f"), round(risks[match(
       sapply(variable, gsub, pattern = ".Any", replacement = ""),
       variable.risks
  ), estimate] * scale, digits))
}

clean_risk.ci <- function(variable, digits = 2, scale = 1000) {
       x <- risks[match(
       sapply(variable, gsub, pattern = ".Any", replacement = ""),
       variable.risks
       ),.(lower, upper)]
       ifelse(!is.na(x$lower), paste0(
         "(",
         sprintf(paste0("%.", digits, "f"), round(x$lower * scale, digits)),
         ", ", 
         sprintf(paste0("%.", digits, "f"), round(x$upper * scale, digits)),
         ")"), NA)
}

clean_rr.ci <- function(estimate, lower, upper, digits = 2) {
  ifelse(!is.na(lower), paste0(
    "(",
    sprintf(paste0("%.", digits, "f"), round(lower, digits)),
    ", ",
    sprintf(paste0("%.", digits, "f"), round(upper, digits)),
    ")"), NA)
}

mwf.flextable <- function(x, n_col = 7) {
  flextable::compose(x, j = c(3, n_col), value = as_paragraph(rep("(95% CI)", 2)),
    part = "header"
  ) |>
  border_remove() |>
  hline_top(part = "header") |>
  hline_top() |> hline_bottom() |>
  flextable::align(j = 2:n_col, align = "center", part = "all") |>
  padding(padding = 1.5, part = "all")
}
```

The observed number of NHL cases over the 30-year follow-up period was
339. Table 2 presents estimates of the counterfactual number of cases,
number of cases averted, and cumulative incidence ratios contrasting
supportable interventions on exposure to soluble MWF based on different
target exposure limits and no censoring. Under an intervention
eliminating censoring, the estimated number of cases was 502 (95% CI:
439, 555). Interventions based on stronger target exposure limits on
soluble MWF resulted in monotonically stronger reductions in the
estimated cumulative incidence of NHL. Setting the target exposure limit
at the NIOSH REL 0.5 mg/m^3^ would have averted 124 (95% CI: 66, 202)
NHL cases.

```{r, eval=F}
tikzDevice::tikz(here::here("reports/private/SER (2023)/resources/rd.tex"),
                 width = 3.75, height = 2.25,
								 documentDeclaration = "\\documentclass{beamer}",
                 bareBones = T)
contrasts.tab[,.(
     label,
     # `Person-years intervened (%)` = clean_percent_py(variable),
     `Cases averted`    = rd * N,
     rd_lower,
     rd_upper,
     result = paste0(
     	round(rd * N),
     	" (", round(rd_lower), ", ", round(rd_upper), ")")
   )][c(6, 3, 2, 5, 4, 1),] -> gg.tab 
gg.tab[label != "None"] |> ggplot(
    aes(x = factor(
    	label,
    	levels = c("0.05", "0.25", "0.5", "1.0", "2.0",  "None"),
    	labels = c("0.05", "0.25", "0.50", "1.00", "2.00",  "None")),
        y = `Cases averted`, ymin = rd_lower, ymax = rd_upper)
  ) +
	geom_label(aes(y = 270, label = result), size = 8/.pt, 
						 label.padding = unit(5, "pt")) +
  geom_errorbar(linewidth = 4 / .pt, width = 0.15, color = '#003c61') +
  geom_point(size = 4 / .pt, color = '#003c61') + 
  geom_hline(yintercept = 0, lty = 2, , alpha = 0.7) +
  labs(
    y = "Cases averted",
    x = "Target limit (mg/m$^3$)") +
  mytheme +
  coord_flip(ylim = c(-10, 320)) +
  theme(panel.grid = element_blank(),
  			axis.text = element_text(size = 9, colour = 'black'),
  			panel.border = element_rect(colour = "black", size = 0.75),
  			axis.title.y = element_text(size = 9, margin = margin(r = 6)),
  			axis.title.x = element_text(size = 9, margin = margin(t = 6)),
  			plot.margin = margin(l = 6, r = 6)
  )
dev.off()
```

```{r}
contrasts.tab[,.(
     label,
     # `Person-years intervened (%)` = clean_percent_py(variable),
     `Cases`  = clean_risk(variable, 0, N),
     `(95% CI)`      = clean_risk.ci(variable, 0, N),
     `Cases averted`    = round(rd * N),
     `(95% CI1)`        = paste0(
       "(",
       round(rd_lower), ", ",
       round(rd_upper), ")"),
     CIR              = sprintf("%.2f", round(rr, 2)),
     `(95% CI2)`   = clean_rr.ci(rr, rr_lower, rr_upper)
   )][c(6, 3, 2, 5, 4, 1),] -> sol.tab
sol.tab[label == "None", 4:7] <- NA

# save(sol.tab, mwf.flextable, file = here::here('resources', 'sol.tab.rdata'))

sol.tab |> flextable() |>
  flextable::compose(
    j = 1,
    value = as_paragraph("Target exposure limit (mg/m", as_sup("3"), ")"),
    part = "header"
  ) |>
  set_header_labels(
    `(95% CI1)` = "(95% CI)",
    `(95% CI2)` = "(95% CI)"
  ) |> mwf.flextable() |>
  width(width = c(1.1, 0.5, 0.9, 0.55, 0.9, 0.5, 0.9)) |>
  add_footer_row(values = paste(
    "CIR: cumulative incidence ratio. MWF: metalworking fluid",
    sep = "\n"), colwidths = 7) |>
  hline_bottom(part = "footer") |>
	set_caption(caption = paste0(
		"Estimates of the counterfactual number of cases, ",
		"number of cases averted ",
		"and cumulative incidence ratios ",
		"contrasting supportable ",
		"interventions on annual average daily exposure to soluble MWF ",
		"to no intervention on exposure."
	))

```

# Discussion

Although NIOSH concluded that there exists substantial evidence linking
MWF exposure to several different cancers including larynx, rectum,
pancreas, skin, scrotum, and bladder cancer, their REL of 0.5 mg/m^3^
for total particulate mass derived from any type of MWF was based on
nonmalignant respiratory health effects [@niosh_1998; @Mirer_2003].
Exposure limits stronger than the NIOSH REL may provide valuable health
protections not previously taken into account by policy makers. Using
the hazard-extended ICE parametric g-formula, we estimated the
counterfactual expected number of NHL cases from 1985 to 2015 in the
UAW-GM cohort if we enforced hypothetical supportable interventions on
soluble MWF based on five different target exposure limits and found a
monotonic exposure-dependent relationship where stronger target exposure
limits yielded lower NHL case count estimates.

The g-formula is a well-known approach in causal inference used for
estimating causal effects in the presence of time-varying confounding
affected by past exposure [@Robins_1986]. Standard representations of
the g-formula include (1) a non-iterated expectation over the joint
density of covariates, (2) the ICE over time, and (3) an inverse
probability weighted expectation. The classic parametric g-formula is a
plug-in estimator for the g-formula under its first, non-iterative,
representation. It involves the parametric modeling of the full joint
distribution of the confounders, exposure, and outcome for each time
point [@Taubman_2009; @Young_2014]. Counterfactual quantities under
hypothetical interventions of interest are computed from Monte Carlo
samples from distributions implied by the fitted parametric models. In
longitudinal settings, this approach often requires specifying and
fitting large number of models in order to satisfy the exchangeability
assumptions necessary for causal identification. Despite this
limitation, analysts often choose the parametric g-formula because of
the intuitive way it handles interventions on the natural value of
exposure. However, these causal estimands are not unique to the
parametric g-formula. The distribution of exposure produced by
marginalizing intervention rules over the observed distribution of
exposure within strata formed by potential confounder and exposure
histories defines a corresponding stochastic dynamic intervention, whose
effects may be estimated using various estimators [@Wen_2020;
@Bang_2005; @van-der-Laan_2011; @Wen_2023; @Diaz_2021]. Estimating
causal effects of this implied stochastic dynamic intervention is
analogous to that of interventions on the natural value of exposure
[@Young_2014].
<!-- Since applications of the parametric g-formula are often context-laden, there are no unified guidelines for model specification. -->

Estimators using the ICE representation of the g-formula are capable of
estimating effects of stochastic dynamic interventions. These ICE
g-formula estimators require modeling only the conditional distributions
of the outcome at each time. Hence, they require fewer parametric
assumptions than the classic parametric g-formula. Counterfactual
outcome estimates over the follow-up period are computed from
interval-specific conditional estimates by applying the tower rule of
expectation. Under the assumptions of conditional exchangeability at all
time points, positivity, counterfactual consistency, and correct model
specification, the hazard-extended parametric g-formula yields unbiased
estimates of counterfactual risk with greater statistical efficiency
than both propensity score-based estimators and the non-extended ICE
g-formula.

Correct model specification is a standard assumption in all parametric
and semi-parametric analyses. In causal analyses of longitudinal cohort
studies, ICE g-formula estimators are less common than the classic
parametric g-formula [@Keil_2014]. However, a major limitation of the
classic g-formula is the g-null paradox: the guaranteed misspecification
of parametric models resulting in the false rejection of the null
hypothesis when the null is true and when there is time-varying
confounding affected by past exposure [@Naimi_2015; @McGrath_2022]. As
with all ICE g-formula estimators, the estimator we applied is not
subject to the g-null paradox. Furthermore, since ICE g-formula
estimators require fewer parametric modeling requirements than the
classic parametric g-formula, correct model specification may be
achieved (or approximated) more readily.

The consistency assumption, also known as the
no-multiple-versions-of-treatment or stable unit treatment value
assumption, is that counterfactual outcomes under each possible exposure
value take on a unique value [@Cole_2009; @VanderWeele_2013]. This
assumption would be violated if there were multiple versions of
treatment causally associated with different outcomes. This basic notion
of consistency is violated in our analysis because our exposure of
interest is a complex mixture of diverse components with substantial
variation over time due to changes in formulation as well as the natural
physical, chemical, and biological changes in the MWF over the course of
its use and reuse [@Howell_2006]. However, causal effect estimates under
violations in the consistency assumption are still valid and unbiased if
there is adequate adjustment for confounders of the exposure-version
relationship [@VanderWeele_2013]. This may be thought of as conditional
consistency within strata, in which there is only one version of
treatment. Our analysis indexed time periods over calendar time and
adjusted for age, year of hire, and plant. In this way, we limited
potential for bias due to variation in MWF composition.

Positivity refers to the need for adequate variation in future exposure
among strata formed by observed covariate and intervention-compliant
exposure histories. Even under conditional exchangeability, where
exposures within these strata may be considered the result of
experimental assignment, expected counterfactual outcomes under
different exposures may not be estimable if there is excessive sparsity
in the observed distribution of exposures [@Maldonado_2002]. Rather than
address potential violations in positivity analytically, we investigated
stochastic dynamic interventions on soluble MWF exposure based on
intervention distributions which are nonzero only where the propensity
score is strictly positive. Hence, our supportable interventions
guarantee positivity. Interventions that guarantee positivity have been
suggested in the past and have also been called "realistic"
interventions [@Petersen_2012].

Conditional exchangeability means that for all time points, there is no
confounding of the relationship between exposure/censoring and both
future exposure/censoring and NHL status given the observed past,
including past exposure and confounders [@Richardson_2013; @Diaz_2021].
A major threat to conditional exchangeability in longitudinal
occupational studies is the HWSE. We limit potential bias due to the
HWSE by conditioning on cumulative exposure, employment status, and
cumulative time off history at each time point. Cumulative time off and
employment status are reasonable mediators of the causal paths linking
past health to future exposure and health, but adjustment for these
variables may not be sufficient for eliminating bias due to the HWSE.
Declines in a worker's health may lead to reductions in work-related
exposure without affecting employment status or time off work
[@Garcia_2017]. We expect the absence of time-varying measures of worker
health over the life course to result in bias toward the null.

<!-- There are three general types of MWF: straight, soluble, and synthetic. The type of MWF applied has changed over the decades in response to engineering, economic, and health considerations. Straight MWF, the oldest class of MWF, is comprised mostly of mineral oils, which were classified as carcinogenic by the International Agency for Research on Cancer (IARC) in 1973, citing studies of occupational exposures among workers in oil, textile, and metal industries [@IARC_1973]. In the same decade, additional factors including the high cost of oil and the introduction of performance-enhancing water-soluble chemical additives spurred the gradual replacement of straight MWF with water-based soluble and synthetic MWF for many, but not all metalworking operations [@Childers_2005]. Although water-based MWFs contain little to no mineral oil, they contain a richer cocktail of additives including chromates, cycloalkanes, phenols, organochlorines, nitrites, sulfonates, and triazines: classes of chemicals with known or plausible carcinogenicity [@IARC_1987; @IARC_2014; @IARC_2017]. As the US prepares for a boom in domestic automotive manufacturing, occupational exposure to MWF will remain an important concern for worker health [@Armbrust_2021; @Carr_2022; @Keilman_2023]. -->

<!-- In the last several decades, there have been substantial changes in the formulation of MWF, including the exclusion of nitrogenous compounds and the use of highly-refined mineral oils. The recent establishment of the Ecolabel for lubricants in the European Union reflects the shift toward prioritizing sustainability and health in the design and production of MWF and other lubricants [@EU_2018;@Skerlos_2008]. However, water-based MWF that satisfy Ecolabel criteria are nonetheless susceptible to the accumulation of dirt, metals, microbes, products of microbial metabolism, and unemulsified oil. These contaminants and their control strategies may also induce risks to human health. Furthermore, adoption of this new class of MWF remains limited, as is evidence of their safety. Considering the evolving complexity in MWF composition, epidemiologic investigations remain an invaluable approach for developing evidence-based occupational health policy and estimating their causal effect. -->

Much of the existing epidemiologic literature linking occupational and
environmental exposures to NHL report findings from case-control studies
where exposures are measured as binary indicators of exposure or as
membership in a particular occupational group [@Cano_2001;
@Costantini_2001; @Karunanayake_2008; @t-Mannetje_2016]. Associations
between occupations and NHL risk vary considerably, but one study of
working men in Kansas and Nebraska found strong associations between NHL
risk and occupations involving metalworking and motor vehicles
[@Zheng_2002]. Both of these occupations may entail exposure to soluble
MWF, which contain mineral oils and a number of chemical additives of
concern for human health and for NHL risk in particular. Organic
compounds containing phosphorous, chlorine, sulfur, nitrogen, and boron
are commonly added to soluble MWF to control microbial growth, improve
performance under high heat/pressure, and inhibit corrosion
[@Evans_2020]. Organophosphorus compounds include organophosphate
pesticides, which have been linked to cancer risk in epidemiologic and
animal studies. Some were classified as possibly carcinogenic by the
IARC [@IARC_2017]. Studies of occupational exposure to chlorinated
solvents and pesticides have also been linked to NHL risk [@Cocco_2008;
@Purdue_2011; @Cocco_2013; @Vlaanderen_2013; @Callahan_2018]. In 2014,
the IARC classified trichloroethylene, tetrachloroethylene, and other
chlorinated agents as Group 1 carcinogens [@IARC_2014]. Chlorinated
solvents are commonly used as degreasers in industrial settings, but
their use in the plants under study here was rare [@Shrestha_2016]. The
structural characteristics shared by MWF additives and known/suspected
carcinogens suggest potential similarities in their behavior in
biological systems.

<!-- Modulation of immune function contributes to the pathogenesis of NHL directly by perturbing lymphocyte function or indirectly by reducing immunosurveillance against neoplasms. Immunodeficiency may also interact with infection with Epstein-Barr Virus, resulting in uncontrolled B-cell proliferation [@Oertel_2002]. Acquired immunodeficiency through infection with human immunodeficiency virus (HIV) can lead to genetic lesions and dysregulation while increasing vulnerability to infection by other oncogenic agents [@Grulich_1999; @Alexander_2007]. -->

This study investigated the effect of supportable interventions on MWF
exposure with guaranteed positivity. We compared the standardized risk
of NHL under post-intervention distributions of exposure based on a
range of target limits on annual average daily exposure to soluble MWF.
We selected a range of hypothetical target exposure limits near the
NIOSH REL of 0.5 mg/m^3^ [@niosh_1998]. If the target exposure limits
were enforced uniformly rather than in a data-supportable way, we would
expect even larger reductions in NHL risk relative to no intervention on
exposure. The supportable interventions we evaluated here provide a more
conservative estimate of the potential health benefit of enforcing
stronger limits on MWF exposure in the real world because they
explicitly restrict the causal contrasts to those supported by the
observed data.

# Conclusions

Associations between several occupations and risk of NHL have been
reported previously, but none to our knowledge evaluated the potential
effect of realistic limits on occupational exposures
[@Ekstrom-Smedby_2006; @Chiu_2015; @t-Mannetje_2016; @Callahan_2018]. We
found evidence that limiting exposure to soluble MWF would reduce NHL
incidence in an analysis that guarantees positivity and adjusts for
time-varying confounding affected by past exposure. \newpage

# Citations

::: {#refs}
:::
